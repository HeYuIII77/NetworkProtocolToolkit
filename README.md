# 网络协议工具箱

## 概述
该应用程序是一个基于 **Windows Forms** 的综合网络协议测试和调试工具，旨在帮助开发人员、系统集成工程师和网络管理员快速测试各种网络协议的连通性和功能性。  
工具支持从基础的 **TCP/IP 连通性测试** 到复杂的 **工业协议通信**，提供了统一的界面来执行和监控各种网络操作。  
程序需要 **管理员权限** 才能修改某些系统设置和访问受限资源。

---

## 功能

### 协议测试模块

#### 连通性检测
- **IP+端口可达性测试**（TCP连接测试）  
- **多种数据库连接测试**（SQL Server、Oracle、MySQL）  
- 实时结果显示和耗时统计  

#### Web协议测试
- **REST API**：支持 POST JSON 请求测试  
- **HTTP/HTTPS**：支持 GET 和 POST 请求  
- **WebSocket**：连接测试和消息回显  
- **WebService (SOAP)**：SOAP 协议调用，支持自定义 SOAPAction  

#### 文件传输协议
- **FTP**：支持匿名和认证访问，目录列表查看  
- **SFTP**：支持密码和私钥认证（使用 Renci.SshNet）  

#### 邮件协议
- **SMTP**：邮件发送功能，支持 SSL/TLS  
- **POP3/IMAP**：邮件收取功能（使用 MailKit 库），支持 SSL/TLS  

#### 工业协议测试
- **S7协议**：西门子 PLC 通信，支持读写操作  
- **Modbus TCP**：工业设备通信，支持寄存器读取  
- **OPC UA**：支持节点读写（使用 Opc.UaFx 或官方库）  
- **OPC DA**：通过 COM 互操作支持  
- **Raw TCP**：原始 TCP 通信测试  

---

### 辅助功能

#### 日志系统
- 分级日志记录（INFO、WARN、ERROR）  
- 详细的请求/响应记录  
- 按日期分割日志文件  
- 日志导出和文件夹管理  

#### 智能库检测
- 动态检测可用的数据库驱动  
- 提供 NuGet 包安装建议  
- 优雅的降级处理  

#### 安全特性
- 连接字符串敏感信息隐藏  
- 统一的错误处理和用户提示  

---

## 界面说明

### 主界面布局
- **选项卡导航**：通过 TabControl 组织不同协议测试页面  
- **统一控件风格**：使用 LabeledTextBox 辅助方法创建一致的输入控件  
- **响应显示区域**：每个协议页面都有专门的响应显示文本框  

### 主要页面功能

#### 连通性检测页
- IP/端口测试输入区域  
- 数据库连接参数配置  
- 结果表格显示（时间、类型、目标、结果、耗时、消息）  

#### REST/HTTP页
- URL 输入和请求体编辑  
- GET/POST 按钮  
- 响应内容显示（支持大文本和滚动）  

#### 上位机协议测试页
- 内嵌选项卡组织不同工业协议  
- S7、Modbus、OPC、Raw TCP 子页面  
- 统一的设备响应显示区域  

#### 日志页
- 日志内容显示（Consolas 字体，支持滚动）  
- 日志管理按钮（清除、导出、打开文件夹）  

---

## 文件结构

- `Form1.cs`：主窗体代码，包含 UI 控件的初始化和事件处理逻辑  
- `Form1.Designer.cs`：Windows Forms 设计器生成的代码  

### 引用的 NuGet 包
- `Renci.SshNet`：SFTP 功能支持  
- `MailKit`：POP3/IMAP 邮件收取  
- `Opc.UaFx.Client`：OPC UA 客户端功能  
- `S7.Net` 或 `S7NetPlus`：S7 协议支持  
- 各种数据库驱动包（可选）  

---

## 运行环境
- **.NET Framework 4.x 或 .NET 6+**  
- **Windows 操作系统**  
- **需要管理员权限** 以访问某些系统资源和修改环境变量  

---

## 使用方法

### 基本操作流程
1. **启动应用程序**  
   - 程序启动时自动创建日志目录并记录启动信息  
   - 检查必要的程序集引用  

2. **选择测试协议**  
   - 通过顶部选项卡选择要测试的协议类型  
   - 填写必要的连接参数（主机、端口、认证信息等）  

3. **执行测试**  
   - 点击相应的测试按钮执行协议操作  
   - 查看消息框中的操作结果  
   - 在响应区域查看详细的返回数据  

4. **查看日志**  
   - 切换到“日志”页面查看详细的操作记录  
   - 使用导出功能保存日志文件  

---

## 具体协议测试示例

### 数据库连接测试
1. 在“连通性检测”页填写数据库连接信息  
2. 选择对应的数据库类型按钮（SQL Server、Oracle、MySQL）  
3. 查看连接结果和耗时统计  

### REST API测试
1. 在“REST”页填写 API URL 和 JSON 请求体  
2. 点击“POST JSON 并显示响应”按钮  
3. 查看响应内容和状态码  

### 工业设备测试
1. 在“上位机协议测试”页选择对应协议子页  
2. 填写设备地址、端口和操作参数  
3. 执行读写操作并查看设备响应  

---

## 注意事项

### 权限要求
- **管理员权限**：某些操作（如系统环境变量修改、受限端口访问）需要管理员权限  
- **防火墙配置**：测试外部服务时可能需要配置防火墙规则  
- **网络访问**：确保测试环境网络连通性  

### 依赖库管理
- **NuGet 包**：程序动态检测所需的程序集，如果缺少会提示安装建议  
- **数据库驱动**：根据需要安装对应的数据库客户端驱动  
- **工业协议库**：S7、OPC 等功能需要安装相应的 NuGet 包  

### 安全考虑
- **敏感信息**：连接字符串中的密码信息会在日志中自动隐藏  
- **证书验证**：HTTPS 测试时可能需要处理自签名证书  
- **网络隔离**：工业协议测试通常在隔离的网络环境中进行  

### 性能提示
- **超时设置**：各协议测试都有合理的超时控制  
- **资源释放**：所有网络连接和资源都会正确释放  
- **异步操作**：使用 async/await 避免 UI 阻塞  

---

## 配置文件说明

### 日志配置
```json
{
  "LogDirectory": "Log",
  "MaxLogFileSize": "10MB",
  "RetentionDays": 30
}
```

### 数据库连接模板
程序内置了连接字符串构建逻辑，支持：
- SQL Server：集成认证和 SQL 认证  
- Oracle：TNS 连接描述符  
- MySQL：标准连接参数  

---

## 故障排除

### 常见问题
**“未找到对应的数据库驱动”**  
> 解决方案：通过 NuGet 安装对应的数据库连接包  

**“连接超时”**  
> 检查目标服务是否运行  
> 验证网络连通性  
> 检查防火墙设置  

**“证书验证失败”**  
> 对于测试环境，可暂时忽略证书验证  
> 或安装相应的 CA 证书  

**“权限不足”**  
> 以管理员身份运行程序  
> 检查用户账户控制设置  

### 日志分析
- 所有操作都会记录到日志文件中  
- 详细日志包含请求和响应的完整信息  
- 导出日志文件便于问题分析和技术支持  

---

## 技术支持
如果遇到问题，请：
1. 查看当天的日志文件  
2. 检查是否安装了必要的 NuGet 包  
3. 验证网络连接和目标服务状态  

如需进一步帮助，可提供日志文件给技术支持人员。  

---

该工具箱持续更新，欢迎反馈使用体验和改进建议！
